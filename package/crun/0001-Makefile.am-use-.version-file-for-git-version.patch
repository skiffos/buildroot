From 818012b2070ba6bcd096016fd7f3fa4076f9a5cf Mon Sep 17 00:00:00 2001
From: Christian Stewart <christian@paral.in>
Date: Sat, 20 Aug 2022 20:21:31 -0700
Subject: [PATCH] Makefile.am: use .version file for git version

Signed-off-by: Christian Stewart <christian@paral.in>
---
 Makefile.am | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 5800406..97aad82 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -151,9 +151,7 @@ TESTS = tests/test_capabilities.py \
 	$(AM_V_GEN)echo $(VERSION) > $@-t && mv $@-t $@
 
 git-version.h:
-	@if test -e $(abs_top_srcdir)/.git; then \
-		$(AM__GEN)printf "/* autogenerated.  */\n#ifndef GIT_VERSION\n# define GIT_VERSION \"%s\"\n#endif\n" $(shell git --git-dir=$(abs_top_srcdir)/.git rev-parse HEAD) > $@-t && mv $@-t $@; \
-	fi
+	$(AM__GEN)printf "/* autogenerated.  */\n#ifndef GIT_VERSION\n# define GIT_VERSION \"%s\"\n#endif\n" $(shell cat $(abs_top_srcdir)/.version) > $@-t && mv $@-t $@
 
 nixpkgs:
 	@nix run -f channel:nixpkgs-unstable nix-prefetch-git -c nix-prefetch-git \
-- 
2.37.2

